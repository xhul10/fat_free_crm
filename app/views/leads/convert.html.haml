- content_for :javascript do
  :javascript
    function select_account() {
      $("account_selector").update("(select existing or <a href='#' onclick='create_account(); return false;'>create new</a>):");
      $("select_account").show();
      $("create_account").hide();
      $("request").value = "select";
      $("account").focus();
    }

    function create_account() {
      $("account_selector").update("(<a href='#' onclick='select_account(); return false;'>select existing</a> or create new):");
      $("select_account").hide();
      $("create_account").show();
      $("request").value = "create";
      $("account_name").focus();
    }

- content_for :javascript_epilogue do
  <script type="text/javascript">
  - if @lead.errors && @lead.errors.on(:name)
    create_account();
  - else
    select_account();
  </script>

.form
  - form_for(@lead, :url => promote_lead_path(@lead)) do |f|
    = hidden_field_tag "lead[user_id]", @current_user.id
    = hidden_field_tag "request", ""
    .title== Convert #{@lead.full_name}
    = f.error_messages
    .section
      %small
        == Congratulations! By converting the lead #{@lead.full_name} will become a contact associated with 
        the existing or newly created account. Lead status will be automatically set to converted.
      %table{ :width => 500, :cellpadding => 0, :cellspacing => 0 }
        %tr
          %td{ :valign => :top }
            - fields_for(@account) do |a|
              .label.req
                Account
                %span#account_selector
              #select_account{ hidden }
                /= select_tag :account, options_from_collection_for_select(@accounts, :id, :name), { :style => "width:330px" }
                = collection_select :account, :id, @accounts, :id, :name, {}, { :style => "width:330px" }
              #create_account{ hidden }
                = a.text_field :name, :style => "width:324px;"
          %td= spacer
          %td{ :valign => :top }
            .label.req Assigned to:
            = collection_select :lead, :assigned_to, @users, :id, :full_name, { :include_blank => "Myself" }, { :style => "width:160px" }
    = render :partial => "opportunity", :locals => { :f => f }
    = render :partial => "convert_permissions",  :locals => { :f => f }
    .buttonbar
      = f.submit "Convert"
      or
      = link_to "Cancel", leads_url

