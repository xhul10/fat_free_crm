- asset = controller_name.singularize
- f.object.tags = unsaved_param_tags(asset) if params[asset] and params[asset][:tag_list]

- f.object.class.custom_fields.group_by(&:field_group_id).each do |field_group_id, fields|
  - field_group = FieldGroup.find(field_group_id)
  - next unless field_group.tag_id.nil? or f.object.tags.map(&:id).include?(field_group.tag_id)

  - collapsed = session[field_group.key].nil?
  = subtitle field_group.key, collapsed, field_group.name
  .section
    %small{ hidden_if(!collapsed).merge(:id => "#{field_group.key}_intro") }
    %div[field_group]{ hidden_if(collapsed) }
      %table
        - fields.sort_by(&:position).in_groups_of(2) do |group|
          %tr
            %td
              - if (field = group[0])
                = f.input field.name, field.input_options
            %td
              = spacer
            %td
              - if (field = group[1])
                = f.input field.name, field.input_options
