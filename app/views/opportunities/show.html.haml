= styles_for :task, :contact

#confirm{ hidden }
.title_tools#menu
  = link_to_inline(:edit_opportunity, edit_opportunity_path(@opportunity), :text => t(:edit)) + " | "
  = link_to_function(t(:delete) + '?', confirm_delete(@opportunity))
.title#edit_opportunity_title= h(@opportunity.name)

%div#edit_opportunity{ hidden }

= render :partial => "comments/new", :locals => { :commentable => @opportunity }
= render :partial => "common/timeline", :collection => @timeline

= section(@opportunity, :tasks)
.log#tasks
  = render :partial => "common/tasks"

= section(@opportunity, :contacts)
.list#contacts
  = render :partial => "contacts/contact", :collection => @opportunity.contacts

= hook(:show_opportunity_bottom, self)

= content_for(:javascript_epilogue) do
  :plain
    document.observe("dom:loaded", function() {
      new crm.Popup({
        trigger     : "select_contact",
        target      : "jumpbox",
        under       : "select_contact",
        appear      : 0.3,
        fade        : 0.3,
        before_show : function() {
          $("jumpbox_menu").hide();
          $("jumpbox_label").innerHTML = "Contacts:"
          $("jumpbox_label").show();
          crm.auto_complete("contacts");
        },
        after_show  : function() {
          $("auto_complete_query").focus();
        },
        after_hide  : function() {
        }
      });

      new crm.Popup({
        trigger     : "select_task",
        target      : "jumpbox",
        under       : "select_task",
        appear      : 0.3,
        fade        : 0.3,
        before_show : function() {
          $("jumpbox_menu").hide();
          $("jumpbox_label").innerHTML = "Tasks:"
          $("jumpbox_label").show();
          crm.auto_complete("tasks");
        },
        after_show  : function() {
          $("auto_complete_query").focus();
        },
        after_hide  : function() {
        }
      });
    });
